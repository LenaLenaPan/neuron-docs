# 概览

## 模块描述

DL/T645-1997 是中国用于电子能量计量器的技术标准，也被称为《电子能量计量器通信协议》。该标准规定了电子能量计量器与数据采集系统之间进行信息交换的通信协议和数据格式。

DL/T645-1997 定义了数据帧的结构、数据字段的内容以及传输能耗和其他相关信息的通信方法。它涵盖了诸多方面，如抄表、负荷控制、事件记录和参数设置等。

该标准为能量计量器与供电公司或其他参与能源监测和管理的实体之间的通信提供了共同的框架。它实现了对能量使用情况进行准确高效的数据采集、计费和分析。

需要注意的是，DL/T645-1997 标准相对较旧，它于1997年发布。自那时以来，可能已经推出了更新版本或后续标准，以适应技术的进展并满足新的需求。

DL/T645-1997 插件支持串口连接和透传的 TCP 连接。

## 参数配置

### serival

| 字段               | 说明                               |
| ----------------- | -------------------------------- |
| **连接超时时间**    | 向设备发送请求超时时间               |
| **指令发送间隔**    | 读指令时间间隔，单位为 ms            |
| **串口设备**       | 使用串口设备，例如，/dev/ttyUSB0    |
| **停止位**         | 停止位，默认值是 1                  |
| **校验位**         | 校验位，默认值是 2，代表偶校验        |
| **波特率**         | 波特率，默认值是 9600               |
| **数据位**         | 数据位，默认值是 8                  |

### TCP

| 字段                 | 说明                                                    |
| ------------------- | ------------------------------------------------------- |
| **连接超时时间**      | 向设备发送请求超时时间               |
| **指令发送间隔**      | 读指令时间间隔                      |
| **IP 地址**          | 当 Neuron 作为客户端使用时，填写远程设备的 IP。当 Neuron 作为服务端使用时，填写 Neuron 在本地使用的 IP，默认可填写 0.0.0.0  |
| **端口号**            | 当 Neuron 作为客户端使用时，post 指远程设备的 TCP 端口。当 Neuron 作为服务端使用时，host 指 Neuron 在本地使用的 TCP 端口  |
| **连接模式**          | 驱动程序连接到设备的方式，默认为 client，即把 Neuron 作为客户端使用 |

## 支持的数据类型

* UINT32
* UINT64

## 地址格式用法

### 地址格式

> mail_address#DI<sub>1</sub>-DI<sub>0</sub> </span>

* mail_address 代表电表的通信地址。
* DI<sub>1</sub>-DI<sub>0</sub> 代表的是数据标识，所有点位只支持读属性，且用十六进制表示。

例如，123456789012#B6-11，代表通信地址为 123456789012 的电表设备的 A 相电压的值。

:::tip
支持一个节点配置多个通信地址的点位，即单串口的多设备连接。

具体的数据标识对应的数据项名称请参考 DL/T645-1997 行业标准的数据编码表格。

* 数据长度 4 以内，数据类型选择 UINT32；
* 数据长度 8 以内，数据类型选择 UINT64；
* 根据数据格式设置 Decimal 的值，例如数据格式为 XXX.X，则 Decimal 设置为 0.1；
:::

| DI<sub>1</sub>        | DI<sub>0</sub> | 说明                     | 数据类型 | Decimal 值 | 举例                                                         |
| --------------------- | -------------- | ------------------------ | -------- | ---------- | ------------------------------------------------------------ |
| 90 ~ 99               | 10 ~ 6E        | 电能量数据标识           | UINT32   | 0.01       | 90-10 表示（当前）正向有功总电能                             |
| A0 ~ A9               | 10 ~ 6E        | 最大需量数据标识         | UINT32   | 0.0001     | A0-10 表示（当前）正向有功总最大需量                         |
| B0, B1,B4, B5, B8, B9 | 10 ~ 6E        | 最大需量发生时间数据标识 | UINT32   | 0          | B0-10表示（当前）正向有功总最大需量发生时间                  |
| B2, B3, B6            | 10 ~ 15        | 变量数据标识             | -        | -          | B6-11 表示 A 相电压，Decimal 值为 0 <br />B6-21 表示 A 相电流，Decimal 值为 0.01 |
| C0 ~ C5               | 10 ~ AE        | 参变量数据标识           | -        | -          | C0-32 表示表号                                               |